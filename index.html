<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>Комічне у мемах воєнного часу — 2025</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body {font-family:'Comic Sans MS',Arial;background:linear-gradient(135deg,#0057b7,#ffd700);color:white;margin:0;padding:20px;min-height:100vh;}
  h1 {text-align:center;font-size:3em;text-shadow:4px 4px #000;}
  .tabs {display:flex;flex-wrap:wrap;justify-content:center;gap:15px;margin:30px 0;}
  .tab {padding:15px 30px;background:#000;color:#ffd700;border:3px solid #ffd700;border-radius:15px;cursor:pointer;font-weight:bold;font-size:1.3em;}
  .tab.active {background:#ffd700;color:#000;}
  .content {display:none;background:rgba(0,0,0,0.85);padding:40px;border-radius:25px;max-width:1100px;margin:20px auto;box-shadow:0 0 30px #000;}
  .content.active {display:block;}
  .section {background:rgba(0,50,100,0.9);padding:25px;margin:20px 0;border:4px dashed #ffd700;border-radius:15px;min-height:240px;}
  .meme {width:190px;margin:10px;border:5px solid #fff;border-radius:15px;cursor:grab;box-shadow:0 0 20px #ff0;transition:0.3s;}
  .meme:active {transform:scale(1.15);}
  .meme-bank {display:flex;flex-wrap:wrap;justify-content:center;gap:15px;padding:20px;background:rgba(0,0,0,0.5);border-radius:20px;}
  button {background:#ffd700;color:#000;padding:14px 28px;margin:12px;font-size:1.2em;border:none;border-radius:12px;cursor:pointer;font-weight:bold;}
  button:hover {background:#fff;transform:scale(1.05);}
  .admin {background:#c00;padding:15px;text-align:center;display:none;font-weight:bold;}
  #adminLogin {text-align:center;margin:30px;}
  .q {max-width:900px;margin:60px auto;font-size:1.5em;text-align:center;display:none;}
  .q.active {display:block;}
  .progress-container {text-align:center;margin:40px 0;}
  #progress {display:flex;justify-content:center;flex-wrap:wrap;gap:12px;margin:20px 0;}
  #progress button {width:90px;height:50px;border-radius:25px;border:none;font-weight:bold;font-size:1em;}
  .answered-a {background:#0057b7 !important;color:white !important;}
  .answered-b {background:#d40000 !important;color:white !important;}
  .answered-c {background:#ffd700 !important;color:#000 !important;}
  .not-answered {background:#333;color:#aaa;}
  #progressText {font-size:1.6em;color:#ffd700;margin-top:15px;}
  .result {background:#000;padding:50px;border:6px solid #ffd700;border-radius:30px;text-align:center;font-size:1.6em;}
  .result img {max-width:90%;margin:30px 0;border-radius:25px;border:5px solid #ffd700;}
</style>
</head>
<body>

<h1>КОМІЧНЕ У МЕМАХ ВОЄННОГО ЧАСУ</h1>

<div id="adminLogin">
  <input type="password" id="pass" placeholder="Пароль адміна">
  <button onclick="login()">Увійти</button>
</div>
<div id="adminPanel" class="admin">АДМІН-РЕЖИМ <button onclick="logout()">Вийти</button></div>

<div class="tabs">
  <div class="tab active" onclick="openTab('constructor')">Конструктор</div>
  <div class="tab" onclick="openTab('quest')">Квест: Який ти мем?</div>
  <div class="tab" onclick="openTab('gallery')">Готовий каталог</div>
  <div class="tab" onclick="openTab('add')">Додати мем</div>
</div>

<!-- КОНСТРУКТОР -->
<div id="constructor" class="content active">
  <h2 style="text-align:center;">Перетягни меми в розділи</h2>
  <div id="memeBank" class="meme-bank"></div>
  <h2 style="text-align:center;margin-top:50px;">Розділи каталогу</h2>
  <div class="section" ondrop="drop(event)" ondragover="allowDrop(event)" id="s1">1. Паліяниця та мова</div>
  <div class="section" ondrop="drop(event)" ondragover="allowDrop(event)" id="s2">2. Техніка та «чмоні»</div>
  <div class="section" ondrop="drop(event)" ondragover="allowDrop(event)" id="s3">3. Тварини-герої</div>
  <div class="section" ondrop="drop(event)" ondragover="allowDrop(event)" id="s4">4. Чорний гумор та абсурд</div>
  <div class="section" ondrop="drop(event)" ondragover="allowDrop(event)" id="s5">5. Самоіронія українців</div>
  <div class="section" ondrop="drop(event)" ondragover="allowDrop(event)" id="s6">6. Меми-підтримка ЗСУ</div>
</div>

<!-- КВЕСТ -->
<div id="quest" class="content">
  <h2 style="font-size:2.8em;text-align:center;">Який ти мем воєнного часу?</h2>

  <div id="questionContainer" style="max-width:900px;margin:40px auto;text-align:center;font-size:1.5em;">

    <div class="question active" id="q1">
      <p><strong>1.</strong> Повітряна тривога. Ти:</p>
      <button onclick="next(1,'a')">Біжу в укриття з котом і борщем</button><br><br>
      <button onclick="next(1,'b')">«Та я ще 5 хвилин полежу…»</button><br><br>
      <button onclick="next(1,'c')">Вмикаю «Байрактар» на всю</button>
    </div>

    <div class="question" id="q2"><p><strong>2.</strong> Побачив «бавовну»:</p>
      <button onclick="next(2,'a')">Пишу «Чорнобаївка №38»</button><br><br>
      <button onclick="next(2,'b')">Ставлю сердечко під пост ЗСУ</button><br><br>
      <button onclick="next(2,'c')">Шукаю мем «прилетіло точно»</button>
    </div>

    <div class="question" id="q3"><p><strong>3.</strong> Тобі пропонують «русскій мір»:</p>
      <button onclick="next(3,'a')">«Паляниця?»</button><br><br>
      <button onclick="next(3,'b')">«Доброго вечора, ми з України»</button><br><br>
      <button onclick="next(3,'c')">Показую мем з кораблем</button>
    </div>

    <div class="question" id="q4"><p><strong>4.</strong> Вимкнули світло:</p>
      <button onclick="next(4,'a')">Свічки + чай = романтика</button><br><br>
      <button onclick="next(4,'b')">Генератор вмикаю першим</button><br><br>
      <button onclick="next(4,'c')">«Я і так на батарейках»</button>
    </div>

    <div class="question" id="q5"><p><strong>5.</strong> Улюблений герой:</p>
      <button onclick="next(5,'a')">Пес Патрон</button><br><br>
      <button onclick="next(5,'b')">Тракторист</button><br><br>
      <button onclick="next(5,'c')">Бабуся з огірками</button>
    </div>

    <div class="question" id="q6"><p><strong>6.</strong> Саундтрек війни:</p>
      <button onclick="next(6,'a')">«Червона калина»</button><br><br>
      <button onclick="next(6,'b')">«Байрактар»</button><br><br>
      <button onclick="next(6,'c')">«Доброго вечора»</button>
    </div>

    <div class="question" id="q7"><p><strong>7.</strong> На блокпосту:</p>
      <button onclick="next(7,'a')">Пригощаю ЗСУ</button><br><br>
      <button onclick="next(7,'b')">Фоткаюсь з Джавеліном</button><br><br>
      <button onclick="next(7,'c')">Кричу «Слава Україні!»</button>
    </div>

    <div class="question" id="q8"><p><strong>8.</strong> Черга за сіллю:</p>
      <button onclick="next(8,'a')">Беру 10 пачок</button><br><br>
      <button onclick="next(8,'b')">Роблю мем</button><br><br>
      <button onclick="next(8,'c')">Віддаю свою бабусі</button>
    </div>

    <div class="question" id="q9"><p><strong>9.</strong> Найсмішніше:</p>
      <button onclick="next(9,'a')">Трактор тягне танк</button><br><br>
      <button onclick="next(9,'b')">«Паляниця»</button><br><br>
      <button onclick="next(9,'c')">Коти з Бахмута</button>
    </div>

    <div class="question" id="q10"><p><strong>10.</strong> Твоя суперсила:</p>
      <button onclick="next(10,'a')">Віра в ЗСУ</button><br><br>
      <button onclick="next(10,'b')">Непробивний гумор</button><br><br>
      <button onclick="next(10,'c')">Любов до України</button>
    </div>

  </div>

  <div id="finalResult" class="result hidden" style="margin-top:50px;"></div>
</div>

<!-- ГАЛЕРЕЯ -->
<div id="gallery" class="content">
  <h2>Готовий каталог (всі бачать)</h2>
  <div id="savedCatalog"></div>
</div>

<!-- ДОДАТИ МЕМ -->
<div id="add" class="content" style="display:none;">
  <h2>Додати новий мем (адмін)</h2>
  <input type="file" id="newMemeFile" accept="image/*"><br><br>
  <input type="text" id="newMemeUrl" placeholder="або встав посилання"><br><br>
  <button onclick="addNewMeme()">Додати в банк</button>
</div>

<script>
// ТВІЙ SUPABASE (працює!)
const supabase = window.supabase.createClient(
  'https://goklujojesauzxwpdqdp.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdva2x1am9qZXNhdXp4d3BkcWRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4NTgxNjgsImV4cCI6MjA4MDQzNDE2OH0.iRo0Sz54Us3eeUweqxq4NuYAIjPSIdTWgfCgZhec8Fc'
);

const ADMIN_PASS = 'Lyceum53';
let isAdmin = false;
let answers = new Array(10).fill(null);

// === АДМІН ===
function login() {
  if (document.getElementById('pass').value === ADMIN_PASS) {
    isAdmin = true;
    document.getElementById('adminLogin').style.display = 'none';
    document.getElementById('adminPanel').style.display = 'block';
    document.getElementById('add').style.display = 'block';
  } else alert('Неправильно!');
}
function logout() { location.reload(); }

// === ЗАВАНТАЖЕННЯ МЕМІВ ===
async function loadMemes() {
  const { data } = await supabase.from('memes').select('src').order('id');
  const bank = document.getElementById('memeBank');
  bank.innerHTML = '';
  if (data && data.length > 0) {
    data.forEach(m => {
      const img = document.createElement('img');
      img.className = 'meme';
      img.src = m.src;
      img.draggable = true;
      img.ondragstart = drag;
      bank.appendChild(img);
    });
  } else {
    bank.innerHTML = '<p style="color:#ff0;">Мемів немає — додай через вкладку "Додати мем"</p>';
  }
  loadCatalog();
}

// === КАТАЛОГ ===
async function loadCatalog() {
  const { data } = await supabase.from('catalog').select('*').single();
  if (data) {
    for (let i = 1; i <= 6; i++) {
      if (data['s'+i]) document.getElementById('s'+i).innerHTML = data['s'+i];
    }
  }
  showGallery();
}

async function saveCatalog() {
  if (!isAdmin) return;
  const catalog = {};
  for (let i = 1; i <= 6; i++) catalog['s'+i] = document.getElementById('s'+i).innerHTML;
  await supabase.from('catalog').upsert({ id: 1, ...catalog });
}

// === ДОДАТИ МЕМ ===
async function addNewMeme() {
  if (!isAdmin) return alert('Тільки адмін!');
  let src = document.getElementById('newMemeUrl').value.trim();
  const file = document.getElementById('newMemeFile').files[0];
  if (file) {
    const { data, error } = await supabase.storage.from('memes').upload('public/'+Date.now()+'_'+file.name, file);
    if (error) return alert(error.message);
    src = supabase.storage.from('memes').getPublicUrl(data.path).data.publicUrl;
  }
  if (src) {
    await supabase.from('memes').insert({ src });
    loadMemes();
    alert('Мем додано!');
  }
}

// === DRAG & DROP ===
function allowDrop(e) { e.preventDefault(); }
function drag(e) { e.dataTransfer.setData("text", e.target.outerHTML); }
function drop(e) {
  e.preventDefault();
  e.target.innerHTML += e.dataTransfer.getData("text");
  if (isAdmin) saveCatalog();
}

// === ГАЛЕРЕЯ ===
function showGallery() {
  const titles = ["Паліяниця та мова","Техніка та «чмоні»","Тварини-герої","Чорний гумор","Самоіронія","Підтримка ЗСУ"];
  let html = '';
  for (let i = 1; i <= 6; i++) {
    const content = document.getElementById('s'+i).innerHTML.trim();
    if (content) html += `<h2>${titles[i-1]}</h2><div class="section">${content}</div>`;
  }
  document.getElementById('savedCatalog').innerHTML = html || '<p style="text-align:center;color:#ff0;">Каталог порожній — розсортуй меми в Конструкторі!</p>';
}

// === КВЕСТ ===
let answers = [];

function next(q, choice) {
  answers[q-1] = choice;

  // ховаємо всі питання
  document.querySelectorAll('.question').forEach(el => el.classList.remove('active'));

  // показуємо наступне або результат
  if (q < 10) {
    document.getElementById('q' + (q + 1)).classList.add('active');
  } else {
    showResult();
  }
}

function showResult() {
  const count = {a:0, b:0, c:0};
  answers.forEach(x => count[x]++);

  const max = Object.keys(count).reduce((a,b) => count[a] >= count[b] ? a : b);

  const results = {
    a: {name: "Паляниця", text: "Ти — найсильніший пароль України! Ворог тебе ніколи не вимовить!", img: "https://i.ibb.co/4pQ8hZc/palianytsya1.jpg"},
    b: {name: "Русскій воєнний корабель", text: "Коротко. Влучно. Історично.", img: "https://i.ibb.co/09T1s1Q/ship.jpg"},
    c: {name: "Український трактор", text: "Тягнеш танки додому швидше за ЗСУ!", img: "https://i.ibb.co/4pQ8hZc/tractor1.jpg"}
  };

  const r = results[max];

  document.getElementById('finalResult').innerHTML = `
    <h2 style="font-size:3em;">ТИ — ${r.name}!</h2>
    <p style="font-size:1.8em;">${r.text}</p>
    <img src="${r.img}" style="max-width:90%;border-radius:25px;border:5px solid #ffd700;">
    <br><br>
    <button onclick="location.reload()" style="font-size:1.4em;padding:20px 40px;">Пройти ще раз</button>
  `;
  document.getElementById('finalResult').classList.remove('hidden');
  document.getElementById('questionContainer').style.display = 'none';
}

// старт
document.getElementById('q1').classList.add('active');

// === ВКЛАДКИ ===
function openTab(id) {
  document.querySelectorAll('.content').forEach(c=>c.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelector(`[onclick="openTab('${id}')"]`).classList.add('active');
  if(id==='gallery') showGallery();
}

// СТАРТ
loadMemes();
updateProgress();
</script>
</body>
</html>
